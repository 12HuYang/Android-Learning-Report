<!DOCTYPE html><html><head><title>拓展 Android 原生 CountDownTimer 倒计时</title><meta charset='utf-8'><link href='https://dn-maxiang.qbox.me/res-min/themes/marxico.css' rel='stylesheet'><style></style></head><body><div id='preview-contents' class='note-content'>
                        
                    



<h2 id="拓展-android-原生-countdowntimer-倒计时">拓展 Android 原生 CountDownTimer 倒计时</h2>

<div><div class="toc"><div class="toc">
<ul>
<li><ul>
<li><a href="#拓展-android-原生-countdowntimer-倒计时">拓展 Android 原生 CountDownTimer 倒计时</a><ul>
<li><ul>
<li><a href="#countdowntimer">CountDownTimer</a></li>
<li><a href="#normal-模式">Normal 模式</a></li>
<li><a href="#floor-模式">Floor 模式</a></li>
<li><a href="#system-模式">System 模式</a></li>
<li><a href="#systemfix-模式">SystemFix 模式</a></li>
<li><a href="#总结">总结</a></li>
<li><a href="#附言">附言</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>



<h4 id="countdowntimer">CountDownTimer</h4>

<blockquote>
  <p>在系统的<code>CountDownTimer</code>上进行的修改,主要是拓展了功能,当然也保留了系统默认的模式.</p>
  
  <p>四种模式:</p>
  
  <ul><li>Normal模式:  向上取整(我觉得应该是日常中用的最多的)</li>
  <li>Floor模式:  向下取整</li>
  <li>System模式:  系统默认的(保留系统原始功能)</li>
  <li>SystemFix模式:  系统默认会少一个<code>onTick()</code>回调,这里只是把缺的这个回调加进去</li>
  </ul>
</blockquote>

<p>在Activity中的代码如下:</p>



<pre class="prettyprint hljs-dark"><code class="hljs aspectj"><span class="hljs-keyword">final</span> CountDownTimer timer=<span class="hljs-keyword">new</span> CountDownTimer(<span class="hljs-number">10000</span>,<span class="hljs-number">1000</span>,CountDownTimer.NORMAL) {<br>            <span class="hljs-annotation">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">onTick</span><span class="hljs-params">(<span class="hljs-keyword">long</span> millisUntilFinished)</span> </span>{<br>                Log.d(<span class="hljs-string">"test"</span>,<span class="hljs-string">"millisUntilFinished: "</span>+millisUntilFinished);<br>                <span class="hljs-keyword">long</span> l = millisUntilFinished / <span class="hljs-number">1000</span>;<br>                mTs.setText(<span class="hljs-string">""</span>+l);<br>            }<br><br>            <span class="hljs-annotation">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">onFinish</span><span class="hljs-params">()</span> </span>{<br>                Log.d(<span class="hljs-string">"test"</span>,<span class="hljs-string">"onFinish 0"</span>);<br>                mTs.setText(<span class="hljs-string">"0"</span>);<br>            }<br>        };<br><br>        mBt_start.setOnClickListener(<span class="hljs-keyword">new</span> View.OnClickListener() {<br>            <span class="hljs-annotation">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span><span class="hljs-params">(View v)</span> </span>{<br>                timer.start();<br>            }<br>        });<br></code></pre>

<p><strong>对应模式的Log如下所示:</strong></p>



<h4 id="normal-模式">Normal 模式</h4>



<pre class="prettyprint hljs-dark"><code class="hljs cpp"><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">23</span>:<span class="hljs-number">53.595</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">10000</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">23</span>:<span class="hljs-number">54.595</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">9000</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">23</span>:<span class="hljs-number">55.605</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">8000</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">23</span>:<span class="hljs-number">56.605</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">7000</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">23</span>:<span class="hljs-number">57.605</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">6000</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">23</span>:<span class="hljs-number">58.605</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">5000</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">23</span>:<span class="hljs-number">59.605</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">4000</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">24</span>:<span class="hljs-number">00.605</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">3000</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">24</span>:<span class="hljs-number">01.605</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">2000</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">24</span>:<span class="hljs-number">02.615</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">1000</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">24</span>:<span class="hljs-number">03.605</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: onFinish <span class="hljs-number">0</span><br></code></pre>



<h4 id="floor-模式">Floor 模式</h4>



<pre class="prettyprint hljs-dark"><code class="hljs cpp"><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">26</span>:<span class="hljs-number">54.455</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">9000</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">26</span>:<span class="hljs-number">55.455</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">8000</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">26</span>:<span class="hljs-number">56.455</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">7000</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">26</span>:<span class="hljs-number">57.455</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">6000</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">26</span>:<span class="hljs-number">58.455</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">5000</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">26</span>:<span class="hljs-number">59.455</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">4000</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">27</span>:<span class="hljs-number">00.465</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">3000</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">27</span>:<span class="hljs-number">01.465</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">2000</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">27</span>:<span class="hljs-number">02.465</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">1000</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">27</span>:<span class="hljs-number">03.465</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: onFinish <span class="hljs-number">0</span><br></code></pre>



<h4 id="system-模式">System 模式</h4>



<pre class="prettyprint hljs-dark"><code class="hljs cpp"><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">29</span>:<span class="hljs-number">03.035</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">9999</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">29</span>:<span class="hljs-number">04.035</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">8998</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">29</span>:<span class="hljs-number">05.035</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">7996</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">29</span>:<span class="hljs-number">06.035</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">6995</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">29</span>:<span class="hljs-number">07.045</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">5993</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">29</span>:<span class="hljs-number">08.045</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">4992</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">29</span>:<span class="hljs-number">09.045</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">3990</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">29</span>:<span class="hljs-number">10.045</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">2989</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">29</span>:<span class="hljs-number">11.045</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">1987</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">29</span>:<span class="hljs-number">13.035</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: onFinish <span class="hljs-number">0</span><br></code></pre>



<h4 id="systemfix-模式">SystemFix 模式</h4>



<pre class="prettyprint hljs-dark"><code class="hljs cpp"><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">29</span>:<span class="hljs-number">59.795</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">9999</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">30</span>:<span class="hljs-number">00.795</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">8998</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">30</span>:<span class="hljs-number">01.805</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">7997</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">30</span>:<span class="hljs-number">02.795</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">6997</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">30</span>:<span class="hljs-number">03.795</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">5996</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">30</span>:<span class="hljs-number">04.805</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">4994</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">30</span>:<span class="hljs-number">05.805</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">3992</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">30</span>:<span class="hljs-number">06.805</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">2990</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">30</span>:<span class="hljs-number">07.805</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">1989</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">30</span>:<span class="hljs-number">08.805</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: millisUntilFinished: <span class="hljs-number">988</span><br><span class="hljs-number">08</span>-<span class="hljs-number">10</span> <span class="hljs-number">09</span>:<span class="hljs-number">30</span>:<span class="hljs-number">09.795</span> <span class="hljs-number">27628</span>-<span class="hljs-number">27628</span>/didikee.com.demoapk D/test: onFinish <span class="hljs-number">0</span><br></code></pre>

<h4 id="总结">总结</h4>

<blockquote>
  <p>项目里需要倒计时,用到的时候遇到了这个问题,查的时候别人也发现了,但是没看到有人修改,所以自己做了些改动,需要的小伙伴可以直接拿走.=.= <br>
  代码在这里: <a href="https://github.com/didikee/Android-Learning-Report" target="_blank">https://github.com/didikee/Android-Learning-Report</a></p>
</blockquote>

<h4 id="附言">附言</h4>

<blockquote>
  <p>有的小伙伴肯定嫌麻烦,谁会点开那么慢的Github,更不会注册账户<code>Star</code>或者<code>Fork</code>的,如果遇到你可以这样解决”丢一秒”的问题.</p>
</blockquote>



<pre class="prettyprint hljs-dark"><code class="hljs cpp"><span class="hljs-keyword">private</span> CountDownTimer robLiftTimer = <span class="hljs-keyword">new</span> CountDownTimer(<span class="hljs-number">5000</span>, <span class="hljs-number">1000</span>) {<br>        @<span class="hljs-function">Override<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onTick</span><span class="hljs-params">(<span class="hljs-keyword">long</span> millisUntilFinished)</span> </span>{<br><br>            Message msg = Message.obtain();<br>            msg.what = <span class="hljs-number">2</span>;<br>            <span class="hljs-keyword">float</span> v = millisUntilFinished * <span class="hljs-number">1.0f</span> / <span class="hljs-number">1000f</span>;<br>            <span class="hljs-keyword">int</span> round = Math.round(v);<br>            msg.arg1 = round;<br>            Log.e(<span class="hljs-string">"live"</span>, millisUntilFinished + <span class="hljs-string">"--"</span> + round + <span class="hljs-string">"=="</span> + v);<br>            mHandler.sendMessage(msg);<br>            <span class="hljs-keyword">if</span> (round == <span class="hljs-number">2</span>) {<span class="hljs-comment">//第二秒的时候"补"一秒</span><br>                mHandler.postDelayed(<span class="hljs-keyword">new</span> Runnable() {<br>                    @<span class="hljs-function">Override<br>                    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>{<br>                        Message msg = Message.obtain();<br>                        msg.what = <span class="hljs-number">2</span>;<br>                        msg.arg1 = <span class="hljs-number">1</span>;<br>                        mHandler.sendMessage(msg);<br>                    }<br>                }, <span class="hljs-number">1000</span>);<br>            }<br>        }<br></code></pre>

<p>也很简单,对吧.=.=</p></div></body></html>